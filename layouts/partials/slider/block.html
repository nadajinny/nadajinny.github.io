{{/* layouts/hbx/blocks/slider/block.html */}}
<div class="relative w-full overflow-hidden">
  <div class="flex transition-transform duration-700 ease-in-out"
       id="slider-container"
       style="transform: translateX(0%);">

    {{ range $i, $slide := .content.slides }}
      <div class="min-w-full flex-shrink-0 relative">

        {{/* 이미지: slide.image → background.image.filename → background.image.url 순서로 탐색 */}}
        {{ $img := "" }}
        {{ if $slide.image }}
          {{ $img = $slide.image }}
        {{ else if and $slide.background $slide.background.image $slide.background.image.filename }}
          {{ $img = $slide.background.image.filename }}
        {{ else if and $slide.background $slide.background.image $slide.background.image.url }}
          {{ $img = $slide.background.image.url }}
        {{ end }}

        {{ if $img }}
          <img src="{{ $img | relURL }}" 
               alt="{{ $slide.alt | default (printf "slide-%d" $i) }}"
               class="w-full object-cover h-[400px] md:h-[500px] lg:h-[600px]" />
        {{ else }}
          <div class="w-full h-[400px] md:h-[500px] lg:h-[600px] bg-gray-200 flex items-center justify-center">
            <p class="text-gray-500">⚠️ 이미지 없음</p>
          </div>
        {{ end }}

        {{/* 텍스트 오버레이 처리 */}}
        {{ if or $slide.title $slide.text $slide.content }}
          <div class="absolute inset-0 bg-black/40 flex flex-col justify-center items-center text-white p-4">
            {{ with $slide.title }}
              <h2 class="text-3xl md:text-5xl font-bold mb-2 text-center">{{ . | safeHTML }}</h2>
            {{ end }}
            {{ with (or $slide.text $slide.content) }}
              <p class="text-lg md:text-xl text-center">{{ . | safeHTML }}</p>
            {{ end }}
          </div>
        {{ end }}
      </div>
    {{ end }}
  </div>

  <!-- 좌우 버튼 -->
  <button id="prev-btn" class="absolute left-4 top-1/2 transform -translate-y-1/2 bg-black/40 hover:bg-black/60 text-white rounded-full p-2">‹</button>
  <button id="next-btn" class="absolute right-4 top-1/2 transform -translate-y-1/2 bg-black/40 hover:bg-black/60 text-white rounded-full p-2">›</button>

  <!-- 인디케이터 -->
  <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2">
    {{ range $i, $slide := .content.slides }}
      <div class="w-3 h-3 rounded-full bg-white/50" data-index="{{ $i }}"></div>
    {{ end }}
  </div>
</div>

<script>
  const container = document.getElementById('slider-container');
  if (container) {
    const slides = container.children.length;
    let index = 0;
    const indicators = document.querySelectorAll('[data-index]');
    const updateIndicators = () => {
      indicators.forEach((dot, i) => dot.style.background = i === index ? '#fff' : 'rgba(255,255,255,0.5)');
    };

    document.getElementById('next-btn')?.addEventListener('click', () => {
      index = (index + 1) % slides;
      container.style.transform = `translateX(-${index * 100}%)`;
      updateIndicators();
    });

    document.getElementById('prev-btn')?.addEventListener('click', () => {
      index = (index - 1 + slides) % slides;
      container.style.transform = `translateX(-${index * 100}%)`;
      updateIndicators();
    });

    // 자동 슬라이드 (5초마다)
    setInterval(() => {
      index = (index + 1) % slides;
      container.style.transform = `translateX(-${index * 100}%)`;
      updateIndicators();
    }, 5000);

    updateIndicators();
  }
</script>
